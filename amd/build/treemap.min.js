define(["jquery","mod_learninggoalwidget/controller","mod_learninggoalwidget/treemap_module","core/config"],function(l,u,i,d){const s=(a,r,t,n)=>{require(["d3v7"],e=>{i.setupTreemap(a,e,r,t,n,(e,a,r)=>{o(g(e),c(e),m(e),p(e),v(e),a.parent.data.topicid,a.data.goalid,a.data.name,r)}),i.setupSvg()})},o=(a,e,r,t,n,i,d,s,o)=>{u.updateUserProgress({courseid:e,coursemoduleid:r,instanceid:t,userid:n,topicid:i,goalid:d,progress:o}).then(e=>{var e=JSON.parse(e);0!==e.children.length&&(e=new CustomEvent("update_learning_goal_progress",{bubbles:!0,detail:{sender:"treemap",taxonomy:e,treemapId:a}}),l("#"+a)[0].dispatchEvent(e))}).catch(()=>{});i=((e,a,r,t)=>{const n={},i={name:"courseid",value:e},d={name:"coursemoduleid",value:a},s={name:"instanceid",value:r},o={name:"userid",value:t},l={name:"timestamp",value:Math.trunc((new Date).getTime()/1e3)};return[n,i,d,s,o,l]})("preparationSaveProgress",e,r,t),d={name:"goalprogress",value:o};i.push({name:"goalname",value:s}),i.push(d),u.logEvent({courseid:e,coursemoduleid:r,instanceid:t,userid:n,eventparams:i})},g=e=>{e=l(e).closest("div.telm-learninggoals-widget");return l(e).data("treemap-id")},c=e=>{e=l(e).closest("div.telm-learninggoals-widget");return l(e).data("course-id")},m=e=>{e=l(e).closest("div.telm-learninggoals-widget");return l(e).data("coursemodule-id")},p=e=>{e=l(e).closest("div.telm-learninggoals-widget");return l(e).data("instance-id")},v=e=>{e=l(e).closest("div.telm-learninggoals-widget");return l(e).data("user-id")};return{renderTreemap:(a,e,r,t,n,i)=>{require.config({paths:{d3v7:d.wwwroot+"/mod/learninggoalwidget/js/d3.v7.min"}}),u.getLearningGoals({courseid:r,userid:e,coursemoduleid:t,instanceid:n}).then(e=>{e=JSON.parse(e);0<e.children.length&&s(e,a,i,!0)}).catch(()=>{})},renderTreemapView:s}});